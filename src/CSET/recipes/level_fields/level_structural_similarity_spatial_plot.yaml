category: $LEVELTYPE Level Structural Similarity
title: "$METHOD $VARNAME $LEVEL\nStructural Similarity between $BASE_MODEL and $OTHER_MODEL"
description: |
  Extracts $VARNAME at $LEVELTYPE $LEVEL for $BASE_MODEL and $OTHER_MODEL.
  These fields then have the
  structural similarity (SSIM) calculated between them. The $METHOD is applied to the
  SSIM and the result is plotted as a spatial plot.

  The SSIM often varies between +/- 1, although values can
  be outside of this range if the values are outside of
  the expected data range (maximum - minimum of $OTHER_MODEL). Values close to 1 imply the fields are similar;
  values close to -1 imply the values are anticorrelated. Values close to 0 imply the
  fields differ. On maps of the SSIM smaller, and negative values
  appear in the region where the differences occur.

  The SSIM has been setup with a Gaussian kernel with a standard
  deviation of 1.5. This value has been chosen to mimic the perception of the
  human eye, and thus indicate differences detected at a glance.

steps:
  - operator: read.read_cubes
    file_paths: $INPUT_PATHS
    model_names: [$BASE_MODEL, $OTHER_MODEL]
    constraint:
      operator: constraints.combine_constraints
      varname_constraint:
        operator: constraints.generate_var_constraint
        varname: $VARNAME
      cell_methods_constraint:
        operator: constraints.generate_cell_methods_constraint
        cell_methods: []
        varname: $VARNAME
      level_constraint:
        operator: constraints.generate_level_constraint
        coordinate: $LEVELTYPE
        levels: $LEVEL
    subarea_type: $SUBAREA_TYPE
    subarea_extent: $SUBAREA_EXTENT

  - operator: imageprocessing.structural_similarity_model_comparisons
    sigma: 1.5
    spatial_plot: True

  - operator: collapse.collapse
    coordinate: [time]
    method: $METHOD

  - operator: plot.spatial_pcolormesh_plot

  - operator: write.write_cube_to_nc
    overwrite: True
